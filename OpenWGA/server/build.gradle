apply plugin: 'java'
apply plugin: 'war'
apply plugin: 'maven-publish'

compileJava.options.encoding = 'ISO-8859-1'
ant.basedir=project.rootDir

dependencies {
    compile project(":wga");
    compile project(":tmlScript");
    
    compileClasspath project(":wgaBuildTools");
    
    testCompile 'javax.servlet:javax.servlet-api:3.0.1'
    testCompile 'javax.websocket:javax.websocket-api:1.1'
    testCompile 'javax.servlet.jsp:jsp-api:2.2'
    testCompile 'javax.mail:javax.mail-api:1.4.7'
    testCompile 'org.glassfish.jersey.core:jersey-client:2.19'
    testCompile 'net.sourceforge.htmlunit:htmlunit:2.19'
    testCompile 'org.apache.ant:ant:1.9.7'
    testCompile 'org.glassfish.jersey.media:jersey-media-multipart:2.19'
    testCompile 'org.glassfish.jersey.media:jersey-media-json-processing:2.19'
    testCompile 'org.glassfish.jersey.media:jersey-media-json-jackson:2.19'
    
}


task writeVersion << {
    ant.taskdef(name:"writeVersion", classname:"de.innovationgate.ant.WriteVersionTask", classpath: configurations.compileClasspath.asPath)
    ant.writeVersion(target:"server/build/tmp/wgabuild.properties", version: rootProject.version)
    println "Wrote OpenWGA Version: ${rootProject.version}"
}

compileJava.doLast {
    tasks.writeVersion.execute()
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.web
        }
    }
}

war {
    war.archiveName = "openwga-ce.war"
    from('build/tmp') {
        include 'wgabuild.properties' into('WEB-INF')
    }
}

